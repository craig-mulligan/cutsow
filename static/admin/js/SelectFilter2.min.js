/*
SelectFilter2 - Turns a multiple-select box into a filter interface.

Requires core.js, SelectBox.js and addevent.js.
*/(function(e){function t(e){return e.tagName.toLowerCase()!="form"?t(e.parentNode):e}window.SelectFilter={init:function(e,n,r,i){if(e.match(/__prefix__/))return;var s=document.getElementById(e);s.id+="_from";s.className="filtered";var o=s.parentNode.getElementsByTagName("p");for(var u=0;u<o.length;u++)o[u].className.indexOf("info")!=-1?s.parentNode.removeChild(o[u]):o[u].className.indexOf("help")!=-1&&s.parentNode.removeChild(o[u]);var a=quickElement("div",s.parentNode,"");a.className=r?"selector stacked":"selector";var f=quickElement("div",a,"");f.className="selector-available";var l=quickElement("h2",f,interpolate(gettext("Available %s")+" ",[n]));quickElement("img",l,"","src",i+"img/icon-unknown.gif","width","10","height","10","class","help help-tooltip","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[n]));var c=quickElement("p",f,"","id",e+"_filter");c.className="selector-filter";var h=quickElement("label",c,"","for",e+"_input");c.appendChild(document.createTextNode(" "));var p=quickElement("input",c,"","type","text","placeholder",gettext("Filter"));p.id=e+"_input";f.appendChild(s);var d=quickElement("a",f,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[n]),"href",'javascript: (function(){ SelectBox.move_all("'+e+'_from", "'+e+'_to"); SelectFilter.refresh_icons("'+e+'");})()',"id",e+"_add_all_link");d.className="selector-chooseall";var v=quickElement("ul",a,"");v.className="selector-chooser";var m=quickElement("a",quickElement("li",v,""),gettext("Choose"),"title",gettext("Choose"),"href",'javascript: (function(){ SelectBox.move("'+e+'_from","'+e+'_to"); SelectFilter.refresh_icons("'+e+'");})()',"id",e+"_add_link");m.className="selector-add";var g=quickElement("a",quickElement("li",v,""),gettext("Remove"),"title",gettext("Remove"),"href",'javascript: (function(){ SelectBox.move("'+e+'_to","'+e+'_from"); SelectFilter.refresh_icons("'+e+'");})()',"id",e+"_remove_link");g.className="selector-remove";var y=quickElement("div",a,"");y.className="selector-chosen";var b=quickElement("h2",y,interpolate(gettext("Chosen %s")+" ",[n])),w=quickElement("select",y,"","id",e+"_to","multiple","multiple","size",s.size,"name",s.getAttribute("name"));w.className="filtered";var E=quickElement("a",y,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[n]),"href",'javascript: (function() { SelectBox.move_all("'+e+'_to", "'+e+'_from"); SelectFilter.refresh_icons("'+e+'");})()',"id",e+"_remove_all_link");E.className="selector-clearall";s.setAttribute("name",s.getAttribute("name")+"_old");addEvent(p,"keyup",function(t){SelectFilter.filter_key_up(t,e)});addEvent(p,"keydown",function(t){SelectFilter.filter_key_down(t,e)});addEvent(s,"change",function(t){SelectFilter.refresh_icons(e)});addEvent(w,"change",function(t){SelectFilter.refresh_icons(e)});addEvent(s,"dblclick",function(){SelectBox.move(e+"_from",e+"_to");SelectFilter.refresh_icons(e)});addEvent(w,"dblclick",function(){SelectBox.move(e+"_to",e+"_from");SelectFilter.refresh_icons(e)});addEvent(t(s),"submit",function(){SelectBox.select_all(e+"_to")});SelectBox.init(e+"_from");SelectBox.init(e+"_to");SelectBox.move(e+"_from",e+"_to");SelectFilter.refresh_icons(e)},refresh_icons:function(t){var n=e("#"+t+"_from"),r=e("#"+t+"_to"),i=n.find("option:selected").length>0,s=r.find("option:selected").length>0;e("#"+t+"_add_link").toggleClass("active",i);e("#"+t+"_remove_link").toggleClass("active",s);e("#"+t+"_add_all_link").toggleClass("active",n.find("option").length>0);e("#"+t+"_remove_all_link").toggleClass("active",r.find("option").length>0)},filter_key_up:function(e,t){var n=document.getElementById(t+"_from");if(e.which&&e.which==13||e.keyCode&&e.keyCode==13){n.selectedIndex=0;SelectBox.move(t+"_from",t+"_to");n.selectedIndex=0;return!1}var r=n.selectedIndex;SelectBox.filter(t+"_from",document.getElementById(t+"_input").value);n.selectedIndex=r;return!0},filter_key_down:function(e,t){var n=document.getElementById(t+"_from");if(e.which&&e.which==39||e.keyCode&&e.keyCode==39){var r=n.selectedIndex;SelectBox.move(t+"_from",t+"_to");n.selectedIndex=r==n.length?n.length-1:r;return!1}if(e.which&&e.which==40||e.keyCode&&e.keyCode==40)n.selectedIndex=n.length==n.selectedIndex+1?0:n.selectedIndex+1;if(e.which&&e.which==38||e.keyCode&&e.keyCode==38)n.selectedIndex=n.selectedIndex===0?n.length-1:n.selectedIndex-1;return!0}}})(grp.jQuery);